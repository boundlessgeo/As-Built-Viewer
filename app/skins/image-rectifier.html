<% extends ./base.html %>

<% subskin extrahead %>
    <title>As-Built Image Rectifier</title>
    <!-- OpenLayers resources -->
    <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css" />
    <script type="text/javascript" src="script/OpenLayers.js"></script>

    <!-- GeoExt resources -->
    <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/popup.css" />
    <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/layerlegend.css" />
    <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/gxtheme-gray.css" />
    <script type="text/javascript" src="script/GeoExt.js"></script> 

    <!-- gxp resources -->
    <link rel="stylesheet" type="text/css" href="externals/gxp/src/theme/all.css" />
    <script type="text/javascript" src="script/gxp.js"></script> 
        
    <!-- proj4js resources -->
    <!--
    <script type="text/javascript" src="externals/proj4js/lib/proj4js-compressed.js"></script>
    -->

    <!-- app resources -->
    <link rel="stylesheet" type="text/css" href="theme/app/style.css" />
    <!--[if IE]><link rel="stylesheet" type="text/css" href="theme/app/ie.css"/><![endif]-->
    <script type="text/javascript" src="script/AsBuilt.js"></script>
    <script type="text/javascript">
        Ext.BLANK_IMAGE_URL = "externals/openlayers/theme/default/img/blank.gif";
        OpenLayers.ImgPath = "externals/openlayers/img/";
        OpenLayers.Layer.WMS.prototype.DEFAULT_PARAMS.transparent = true;
        OpenLayers.DOTS_PER_INCH = 25.4 / 0.28;

        Ext.ns("AsBuilt");
        AsBuilt.gcps = [];

        new Ext.Viewport({
            layout:'hbox',
            layoutConfig: {
                align : 'stretch',
                pack  : 'start'
             },
             items: [
                 {id: 'map2', flex: 1, title: "Source map"},
                 {id: 'map1', flex: 1, title: "Reference map"}
            ]
        });

        var app = new gxp.Viewer({
            portalConfig: {renderTo: Ext.getCmp('map1').body, height: 800},
            portalItems: ["map"],
            mapItems: [{
                xtype: "gx_zoomslider",
                vertical: true,
                height: 100
            }],
            proxy: "proxy/?url=",
            defaultSourceType: "gxp_wmssource",
            sources: {
                local: {    
                    url: "/geoserver/ows",
                    title: "Local GeoServer",
                    version: "1.1.1"
                },
                osm: {
                    ptype: "gxp_osmsource"
                },
                ol: {
                    ptype: "gxp_olsource"
                }
            },
            tools: [
                {
                    ptype: "app_gcp",
                    coords: "world",
                    gcps: AsBuilt.gcps,
                    layer: {         
                        source: "ol",
                        type: "OpenLayers.Layer.Vector",
                        args: [
                            "GCP"
                        ]
                    }
                }
            ],
            map: {
                id: "map",
                region: "center",
                projection: "EPSG:900913",
                units: "m",
                numZoomLevels: 21,
                maxResolution: 156543.03390625,
                maxExtent: [
                    -20037508.34, -20037508.34,
                    20037508.34, 20037508.34
                ],
                extent: [-13650159, 4534735, -13609227, 4554724],
                layers: [{
                    source: "osm",
                    name: "mapnik",
                    title: "OpenStreetMap",
                    group: "background"
                }, {
                    source: "ol",
                    group: "background",
                    fixed: true,
                    type: "OpenLayers.Layer",
                    args: [
                        "None", {visibility: false}
                    ]
                }, {
                    source: "local",
                    name: "asbuilt:DOCS",
                    title: "Images",
                    selected: true,
                }],
                center: [-13629218, 4545403],
                zoom: 13
            }
        });

        var app2 = new gxp.Viewer({
            portalConfig: {renderTo: Ext.getCmp('map2').body, height: 800},
            portalItems: ["map2"],
            mapItems: [{
                xtype: "gx_zoomslider",
                vertical: true,
                height: 100
            }],
            proxy: "proxy/?url=",
            sources: {
                ol: {
                    ptype: "gxp_olsource"
                }
            },
            tools: [
                {
                    ptype: "app_gcp",
                    coords: "image",
                    gcps: AsBuilt.gcps,
                    layer: {         
                        source: "ol",
                        type: "OpenLayers.Layer.Vector",
                        args: [
                            "GCP"
                        ]
                    }
                }
            ],
            map: {
                id: "map2",
                region: "center",
                units: "m",
                maxExtent: [
                    0, 0,
                    6696, 4097
                ],
                layers: [{
                    source: "ol",
                    type: "OpenLayers.Layer.Image",
                    args: [
                        "Image", "stub/CL-7449.png", new OpenLayers.Bounds(0,0,6696,4097), new OpenLayers.Size(6696, 4097), {maxResolution: 10, visibility: true}
                    ]
                }],
                zoom: 0,
                center: [3348, 2048]
            }
        });

    </script>
